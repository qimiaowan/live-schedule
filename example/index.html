<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <style>
    html,
    body {
      margin: 0;
    }

    .example {
      width: 100vw;
      display: flex;
      margin: 0 auto;
      padding: 0 20px;
      box-sizing: border-box;
    }

    .left {
      width: 250px;
      white-space: nowrap;
      margin-right: 30px;
    }

    .left p {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .feature {
      pointer-events: none;
    }
    #yearMonth {
      padding: 10px 0;
    }

    #schedule {
      flex: 1;
      width: calc(100vw - 310px);
      height: calc(100vh - 120px);
      box-sizing: border-box;
      min-width: 800px;
    }

    .colors {
      display: flex;
      list-style: none;
      padding: 0;
    }

    .colors li {
      display: block;
      width: 50px;
      cursor: pointer;
      margin: 0 2px;
      font-size: 12px;
    }

    .icons {
      display: flex;
      flex-wrap: wrap;
    }

    .icons label {
      margin: 5px;
    }
  </style>
</head>

<body>
  <div class="example">
    <div class="left">
      <h3>功能（已完成/待完成）</h3>
      <div class="feature">
        <p>滑动选择 <Input checked type="checkbox" /></p>
        <p>响应式 <Input checked type="checkbox" /></p>
        <p>多列选择 <Input checked type="checkbox" /></p>
        <p>键盘操作（del、ctrl、shift） <Input checked type="checkbox" /></p>
        <p>跨天 <Input checked type="checkbox" /></p>
        <p>行调整 <Input checked type="checkbox" /></p>
        <p>右键上下文菜单 <Input checked type="checkbox" /></p>
        <p>悬浮提示 <Input checked type="checkbox" /></p>
        <p>时间比例 <Input checked type="checkbox" /></p>
        <p>行重新调整 <Input checked type="checkbox" /></p>
        <p>导入数据 <Input checked type="checkbox" /></p>
        <p>导出数据 <Input type="checkbox" /></p>
        <p>事件监听 <Input checked type="checkbox" /></p>
      </div>

      <h3>操作</h3>
      <h4>给点颜色</h4>
      <ul class="colors">
        <li style="background: #64C42D;" onclick="setColor('L1')">L1</li>
        <li style="background: #E8A32F;" onclick="setColor('L2')">L2</li>
        <li style="background: #F76B69;" onclick="setColor('L3')">L3</li>
        <li style="background: #2A8DF8;" onclick="setColor('L4')">L4</li>
        <li style="background: #442BB0;" onclick="setColor('L5')">L5</li>
      </ul>

      <h4>选个人</h4>
      <p>
        <label for="text1">大姚<Input value="大姚" class="text" id="text1" type="checkbox" onchange="setText()" /></label>
        <label for="text2">库日天<Input value="123444库日天123" class="text" id="text2" type="checkbox"
            onchange="setText()" /></label>
        <label for="text3">tmac<Input value="tamc" class="text" id="text3" type="checkbox"
            onchange="setText()" /></label>
      </p>
      <h4>选个图标</h4>
      <p class="icons" onclick="setIcon()">
        <label for="icon1">
          空<input name="icon" id="icon1" value="" type="radio" />
        </label>
        <label for="淘宝">
          <img width="20" height="20" src="./platform-icons/taobao.png" />
          <Input name="icon" id="淘宝" value="淘宝" type="radio" />
        </label>
        <label for="京东">
          <img width="20" height="20" src="./platform-icons/jd.png" />
          <Input name="icon" id="京东" value="京东" type="radio" />
        </label>
        <label for="抖音">
          <img width="20" height="20" src="./platform-icons/douyin.png" />
          <Input name="icon" id="抖音" value="抖音" type="radio" />
        </label>
        <label for="苏宁">
          <img width="20" height="20" src="./platform-icons/suning.png" />
          <Input name="icon" id="苏宁" value="苏宁" type="radio" />
        </label>
        <label for="微信">
          <img width="20" height="20" src="./platform-icons/wx.png" />
          <Input name="icon" id="微信" value="微信" type="radio" />
        </label>
        <label for="Lazada">
          <img width="20" height="20" src="./platform-icons/lazada.png" />
          <Input name="icon" id="Lazada" value="Lazada" type="radio" />
        </label>
        <label for="tiktok">
          <img width="20" height="20" src="./platform-icons/tiktok.png" />
          <Input name="icon" id="tiktok" value="tiktok" type="radio" />
        </label>
        <label for="shopee">
          <img width="20" height="20" src="./platform-icons/shopee.png" />
          <Input name="icon" id="shopee" value="shopee" type="radio" />
        </label>
        <label for="facebook">
          <img width="20" height="20" src="./platform-icons/facebook.png" />
          <Input name="icon" id="facebook" value="facebook" type="radio" />
        </label>
        <label for="instagram">
          <img width="20" height="20" src="./platform-icons/ins.png" />
          <Input name="icon" id="instagram" value="instagram" type="radio" />
        </label>
        <label for="youtube">
          <img width="20" height="20" src="./platform-icons/youtube.png" />
          <Input name="icon" id="youtube" value="youtube" type="radio" />
        </label>
        <label for="其他">
          <img width="20" height="20" src="./platform-icons/qita.png" />
          <Input name="icon" id="其他" value="其他" type="radio" />
        </label>
      </p>
    </div>

    <div>
      <div id="yearMonth"></div>
      <div id="schedule"></div>
    </div>
  </div>

  <script src="../dist/schedule.js"></script>
  <script>
    const yearMonth = /\d{4}-\d{2}/.exec(new Date(Date.now() - new Date().getTimezoneOffset() * 60 * 1000).toISOString())[0]
    document.getElementById('yearMonth').innerHTML = `当前年月：${yearMonth}`

    const platformIcons = [
      { id: '淘宝', icon: 'taobao.png' },
      { id: '京东', icon: 'jd.png' },
      { id: '抖音', icon: 'douyin.png' },
      { id: '苏宁', icon: 'suning.png' },
      { id: '微信', icon: 'wx.png' },
      { id: 'Lazada', icon: 'lazada.png' },
      { id: 'tiktok', icon: 'tiktok.png' },
      { id: 'shopee', icon: 'shopee.png' },
      { id: 'facebook', icon: 'facebook.png' },
      { id: 'instagram', icon: 'ins.png' },
      { id: 'youtube', icon: 'youtube.png' },
      { id: '其他', icon: 'qita.png' }
    ]

    const levels = [
      { name: '#64c42d', id: 'L1' },
      { name: '#e8a32f', id: 'L2' },
      { name: '#f76b69', id: 'L3' },
      { name: '#2a8df8', id: 'L4' },
      { name: '#442bb0', id: 'L5' }
    ]

    const schedule = new Schedule(document.getElementById('schedule'), {
      yearMonth: /\d{4}-\d{2}/.exec(new Date(Date.now() - new Date().getTimezoneOffset() * 60 * 1000).toISOString())[0],
      data: [
        {
          id: 10958,
          liveTime: ["2020-07-05 03:00:00", "2020-07-06 8:00:00"],
          anchors: [],
          anchorLevel: "L2",
        },
        {
          id: 10958,
          liveTime: ["2020-07-28 10:00:00", "2020-07-28 18:00:00"],
          anchors: [],
          anchorLevel: "L5",
        }
      ],
      timeRangeKey: 'liveTime',
      renderCell(data) {
        if (!data) {
          return null
        }

        const { anchorLevel, anchors = [], platform } = data

        return {
          color: levels.find(l => l.id === anchorLevel)?.name,
          texts: anchors.length ? anchors.map(anchor => anchor) : anchorLevel ? [anchorLevel] : [],
          icon: platform ? `./platform-icons/${platformIcons.find(p => platform === p.id).icon}` : null,
        }
      },

      renderTooltip(data) {
        const titleMap = {
          operationUser: "运营",
          controlUser: "场控",
          liveNumber: "直播间号",
          storeName: "店铺名称",
          platform: "平台",
        }
        return `
          ${Object.keys(data).map(key => (data[key] && titleMap[key]) ? `<p>${titleMap[key]}: ${data[key]}<p/>` : '').join('')}
          <p>${data.anchorLevel || ''}</p>
          <p>${(data.anchors || []).join(',')}</p>
        `
      },

      contextMenuItems: [
        { action: 'alert', title: '弹一个' },
      ],
    })

    schedule.on('contextMenuItemSelect', (action, item) => {
      if (action === 'alert') {
        alert('弹一个')
      }
    })

    schedule.on('select', (items) => {
      console.log({ items })
    })

    function setColor(anchorLevel) {
      schedule.setDataAtSelectedCell(data => ({
        ...data,
        anchorLevel
      }))
    }

    function setText() {
      const anchors = [...document.querySelectorAll('.text')].map(checkbox => checkbox.checked ? checkbox.value : '').filter(text => text)
      schedule.setDataAtSelectedCell(data => ({
        ...data,
        anchors
      }))
    }

    function setIcon() {
      const checkedRadio = [...document.getElementsByName('icon')].find(radio => radio.checked)
      if (checkedRadio) {
        const platform = checkedRadio.value
        schedule.setDataAtSelectedCell(data => ({
          ...data,
          platform
        }))
      }
    }
  </script>
</body>

</html>