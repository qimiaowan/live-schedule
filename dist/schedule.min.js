!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Schedlue=e()}(this,(function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function t(t,e,i){return t(i={path:e,exports:{},require:function(t,e){return function(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},i.exports),i.exports}var e,i=t((function(t){function e(){return t.exports=e=Object.assign||function(t){for(var e=1;arguments.length>e;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},t.exports.default=t.exports,t.exports.__esModule=!0,e.apply(this,arguments)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0})),n=[],r="ResizeObserver loop completed with undelivered notifications.";!function(t){t.BORDER_BOX="border-box",t.CONTENT_BOX="content-box",t.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"}(e||(e={}));var s,o=function(t){return Object.freeze(t)},l=function(t,e){this.inlineSize=t,this.blockSize=e,o(this)},h=function(){function t(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,o(this)}return t.prototype.toJSON=function(){var t=this;return{x:t.x,y:t.y,top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height}},t.fromRect=function(e){return new t(e.x,e.y,e.width,e.height)},t}(),a=function(t){return t instanceof SVGElement&&"getBBox"in t},c=function(t){if(a(t)){var e=t.getBBox();return!e.width&&!e.height}return!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},u=function(t){var e,i;if(t instanceof Element)return!0;var n=null===(i=null===(e=t)||void 0===e?void 0:e.ownerDocument)||void 0===i?void 0:i.defaultView;return!!(n&&t instanceof n.Element)},d="undefined"!=typeof window?window:{},f=new WeakMap,g=/auto|scroll/,p=/^tb|vertical/,v=/msie|trident/i.test(d.navigator&&d.navigator.userAgent),m=function(t){return parseFloat(t||"0")},x=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=!1),new l((i?e:t)||0,(i?t:e)||0)},b=o({devicePixelContentBoxSize:x(),borderBoxSize:x(),contentBoxSize:x(),contentRect:new h(0,0,0,0)}),w=function(t,e){if(void 0===e&&(e=!1),f.has(t)&&!e)return f.get(t);if(c(t))return f.set(t,b),b;var i=getComputedStyle(t),n=a(t)&&t.ownerSVGElement&&t.getBBox(),r=!v&&"border-box"===i.boxSizing,s=p.test(i.writingMode||""),l=!n&&g.test(i.overflowY||""),u=!n&&g.test(i.overflowX||""),d=n?0:m(i.paddingTop),w=n?0:m(i.paddingRight),C=n?0:m(i.paddingBottom),y=n?0:m(i.paddingLeft),I=n?0:m(i.borderTopWidth),M=n?0:m(i.borderRightWidth),S=n?0:m(i.borderBottomWidth),E=y+w,T=d+C,_=(n?0:m(i.borderLeftWidth))+M,H=I+S,D=u?t.offsetHeight-H-t.clientHeight:0,R=l?t.offsetWidth-_-t.clientWidth:0,O=r?E+_:0,z=r?T+H:0,B=n?n.width:m(i.width)-O-R,$=n?n.height:m(i.height)-z-D,W=B+E+R+_,L=$+T+D+H,k=o({devicePixelContentBoxSize:x(Math.round(B*devicePixelRatio),Math.round($*devicePixelRatio),s),borderBoxSize:x(W,L,s),contentBoxSize:x(B,$,s),contentRect:new h(y,d,B,$)});return f.set(t,k),k},C=function(t,i,n){var r=w(t,n),s=r.borderBoxSize,o=r.contentBoxSize,l=r.devicePixelContentBoxSize;switch(i){case e.DEVICE_PIXEL_CONTENT_BOX:return l;case e.BORDER_BOX:return s;default:return o}},y=function(t){var e=w(t);this.target=t,this.contentRect=e.contentRect,this.borderBoxSize=o([e.borderBoxSize]),this.contentBoxSize=o([e.contentBoxSize]),this.devicePixelContentBoxSize=o([e.devicePixelContentBoxSize])},I=function(t){if(c(t))return 1/0;for(var e=0,i=t.parentNode;i;)e+=1,i=i.parentNode;return e},M=function(){var t=1/0,e=[];n.forEach((function(i){if(0!==i.activeTargets.length){var n=[];i.activeTargets.forEach((function(e){var i=new y(e.target),r=I(e.target);n.push(i),e.lastReportedSize=C(e.target,e.observedBox),t>r&&(t=r)})),e.push((function(){i.callback.call(i.observer,n,i.observer)})),i.activeTargets.splice(0,i.activeTargets.length)}}));for(var i=0,r=e;r.length>i;i++){(0,r[i])()}return t},S=function(t){n.forEach((function(e){e.activeTargets.splice(0,e.activeTargets.length),e.skippedTargets.splice(0,e.skippedTargets.length),e.observationTargets.forEach((function(i){i.isActive()&&(I(i.target)>t?e.activeTargets.push(i):e.skippedTargets.push(i))}))}))},E=function(){var t=0;for(S(t);n.some((function(t){return t.activeTargets.length>0}));)t=M(),S(t);return n.some((function(t){return t.skippedTargets.length>0}))&&function(){var t;"function"==typeof ErrorEvent?t=new ErrorEvent("error",{message:r}):((t=document.createEvent("Event")).initEvent("error",!1,!1),t.message=r),window.dispatchEvent(t)}(),t>0},T=[],_=function(t){if(!s){var e=0,i=document.createTextNode("");new MutationObserver((function(){return T.splice(0).forEach((function(t){return t()}))})).observe(i,{characterData:!0}),s=function(){i.textContent=""+(e?e--:e++)}}T.push(t),s()},H=0,D={attributes:!0,characterData:!0,childList:!0,subtree:!0},R=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],O=function(t){return void 0===t&&(t=0),Date.now()+t},z=!1,B=new(function(){function t(){var t=this;this.stopped=!0,this.listener=function(){return t.schedule()}}return t.prototype.run=function(t){var e=this;if(void 0===t&&(t=250),!z){z=!0;var i,n=O(t);i=function(){var i=!1;try{i=E()}finally{if(z=!1,t=n-O(),!H)return;i?e.run(1e3):t>0?e.run(t):e.start()}},_((function(){requestAnimationFrame(i)}))}},t.prototype.schedule=function(){this.stop(),this.run()},t.prototype.observe=function(){var t=this,e=function(){return t.observer&&t.observer.observe(document.body,D)};document.body?e():d.addEventListener("DOMContentLoaded",e)},t.prototype.start=function(){var t=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),R.forEach((function(e){return d.addEventListener(e,t.listener,!0)})))},t.prototype.stop=function(){var t=this;this.stopped||(this.observer&&this.observer.disconnect(),R.forEach((function(e){return d.removeEventListener(e,t.listener,!0)})),this.stopped=!0)},t}()),$=function(t){!H&&t>0&&B.start(),!(H+=t)&&B.stop()},W=function(){function t(t,i){this.target=t,this.observedBox=i||e.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return t.prototype.isActive=function(){var t,e=C(this.target,this.observedBox,!0);return a(t=this.target)||function(t){switch(t.tagName){case"INPUT":if("image"!==t.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1}(t)||"inline"!==getComputedStyle(t).display||(this.lastReportedSize=e),this.lastReportedSize.inlineSize!==e.inlineSize||this.lastReportedSize.blockSize!==e.blockSize},t}(),L=function(t,e){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=t,this.callback=e},k=new WeakMap,F=function(t,e){for(var i=0;t.length>i;i+=1)if(t[i].target===e)return i;return-1},A=function(){function t(){}return t.connect=function(t,e){var i=new L(t,e);k.set(t,i)},t.observe=function(t,e,i){var r=k.get(t),s=0===r.observationTargets.length;0>F(r.observationTargets,e)&&(s&&n.push(r),r.observationTargets.push(new W(e,i&&i.box)),$(1),B.schedule())},t.unobserve=function(t,e){var i=k.get(t),r=F(i.observationTargets,e);0>r||(1===i.observationTargets.length&&n.splice(n.indexOf(i),1),i.observationTargets.splice(r,1),$(-1))},t.disconnect=function(t){var e=this,i=k.get(t);i.observationTargets.slice().forEach((function(i){return e.unobserve(t,i.target)})),i.activeTargets.splice(0,i.activeTargets.length)},t}(),N=function(){function t(t){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof t)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");A.connect(this,t)}return t.prototype.observe=function(t,e){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!u(t))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");A.observe(this,t,e)},t.prototype.unobserve=function(t){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!u(t))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");A.unobserve(this,t)},t.prototype.disconnect=function(){A.disconnect(this)},t.toString=function(){return"function ResizeObserver () { [polyfill code] }"},t}(),j=t((function(t,e){t.exports=function(){var t=6e4,e=36e5,i="millisecond",n="second",r="minute",s="hour",o="day",l="week",h="month",a="quarter",c="year",u="date",d="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,g=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,p=function(t,e,i){var n=t+"";return n&&e>n.length?""+Array(e+1-n.length).join(i)+t:t},v={s:p,z:function(t){var e=-t.utcOffset(),i=Math.abs(e),n=i%60;return(e>0?"-":"+")+p(Math.floor(i/60),2,"0")+":"+p(n,2,"0")},m:function t(e,i){if(e.date()<i.date())return-t(i,e);var n=12*(i.year()-e.year())+(i.month()-e.month()),r=e.clone().add(n,h),s=0>i-r,o=e.clone().add(n+(s?-1:1),h);return+(-(n+(i-r)/(s?r-o:o-r))||0)},a:function(t){return 0>t?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:h,y:c,w:l,d:o,D:u,h:s,m:r,s:n,ms:i,Q:a}[t]||((t||"")+"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},m="en",x={};x[m]={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")};var b=function(t){return t instanceof I},w=function(t,e,i){var n;if(!t)return m;if("string"==typeof t)x[t]&&(n=t),e&&(x[t]=e,n=t);else{var r=t.name;x[r]=t,n=r}return!i&&n&&(m=n),n||!i&&m},C=function(t,e){if(b(t))return t.clone();var i="object"==typeof e?e:{};return i.date=t,i.args=arguments,new I(i)},y=v;y.l=w,y.i=b,y.w=function(t,e){return C(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var I=function(){function p(t){this.$L=w(t.locale,null,!0),this.parse(t)}var v=p.prototype;return v.parse=function(t){this.$d=function(t){var e=t.date,i=t.utc;if(null===e)return new Date(NaN);if(y.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(f);if(n){var r=n[2]-1||0,s=(n[7]||"0").substring(0,3);return i?new Date(Date.UTC(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)):new Date(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},v.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},v.$utils=function(){return y},v.isValid=function(){return!(""+this.$d===d)},v.isSame=function(t,e){var i=C(t);return this.startOf(e)<=i&&i<=this.endOf(e)},v.isAfter=function(t,e){return C(t)<this.startOf(e)},v.isBefore=function(t,e){return this.endOf(e)<C(t)},v.$g=function(t,e,i){return y.u(t)?this[e]:this.set(i,t)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(t,e){var i=this,a=!!y.u(e)||e,d=y.p(t),f=function(t,e){var n=y.w(i.$u?Date.UTC(i.$y,e,t):new Date(i.$y,e,t),i);return a?n:n.endOf(o)},g=function(t,e){return y.w(i.toDate()[t].apply(i.toDate("s"),(a?[0,0,0,0]:[23,59,59,999]).slice(e)),i)},p=this.$W,v=this.$M,m=this.$D,x="set"+(this.$u?"UTC":"");switch(d){case c:return a?f(1,0):f(31,11);case h:return a?f(1,v):f(0,v+1);case l:var b=this.$locale().weekStart||0,w=(b>p?p+7:p)-b;return f(a?m-w:m+(6-w),v);case o:case u:return g(x+"Hours",0);case s:return g(x+"Minutes",1);case r:return g(x+"Seconds",2);case n:return g(x+"Milliseconds",3);default:return this.clone()}},v.endOf=function(t){return this.startOf(t,!1)},v.$set=function(t,e){var l,a=y.p(t),d="set"+(this.$u?"UTC":""),f=(l={},l[o]=d+"Date",l[u]=d+"Date",l[h]=d+"Month",l[c]=d+"FullYear",l[s]=d+"Hours",l[r]=d+"Minutes",l[n]=d+"Seconds",l[i]=d+"Milliseconds",l)[a],g=a===o?this.$D+(e-this.$W):e;if(a===h||a===c){var p=this.clone().set(u,1);p.$d[f](g),p.init(),this.$d=p.set(u,Math.min(this.$D,p.daysInMonth())).$d}else f&&this.$d[f](g);return this.init(),this},v.set=function(t,e){return this.clone().$set(t,e)},v.get=function(t){return this[y.p(t)]()},v.add=function(i,a){var u,d=this;i=Number(i);var f=y.p(a),g=function(t){var e=C(d);return y.w(e.date(e.date()+Math.round(t*i)),d)};if(f===h)return this.set(h,this.$M+i);if(f===c)return this.set(c,this.$y+i);if(f===o)return g(1);if(f===l)return g(7);var p=(u={},u[r]=t,u[s]=e,u[n]=1e3,u)[f]||1,v=this.$d.getTime()+i*p;return y.w(v,this)},v.subtract=function(t,e){return this.add(-1*t,e)},v.format=function(t){var e=this;if(!this.isValid())return d;var i=t||"YYYY-MM-DDTHH:mm:ssZ",n=y.z(this),r=this.$locale(),s=this.$H,o=this.$m,l=this.$M,h=r.weekdays,a=r.months,c=function(t,n,r,s){return t&&(t[n]||t(e,i))||r[n].substr(0,s)},u=function(t){return y.s(s%12||12,t,"0")},f=r.meridiem||function(t,e,i){var n=12>t?"AM":"PM";return i?n.toLowerCase():n},p={YY:(this.$y+"").slice(-2),YYYY:this.$y,M:l+1,MM:y.s(l+1,2,"0"),MMM:c(r.monthsShort,l,a,3),MMMM:c(a,l),D:this.$D,DD:y.s(this.$D,2,"0"),d:this.$W+"",dd:c(r.weekdaysMin,this.$W,h,2),ddd:c(r.weekdaysShort,this.$W,h,3),dddd:h[this.$W],H:s+"",HH:y.s(s,2,"0"),h:u(1),hh:u(2),a:f(s,o,!0),A:f(s,o,!1),m:o+"",mm:y.s(o,2,"0"),s:this.$s+"",ss:y.s(this.$s,2,"0"),SSS:y.s(this.$ms,3,"0"),Z:n};return i.replace(g,(function(t,e){return e||p[t]||n.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(i,u,d){var f,g=y.p(u),p=C(i),v=(p.utcOffset()-this.utcOffset())*t,m=this-p,x=y.m(this,p);return x=(f={},f[c]=x/12,f[h]=x,f[a]=x/3,f[l]=(m-v)/6048e5,f[o]=(m-v)/864e5,f[s]=m/e,f[r]=m/t,f[n]=m/1e3,f)[g]||m,d?x:y.a(x)},v.daysInMonth=function(){return this.endOf(h).$D},v.$locale=function(){return x[this.$L]},v.locale=function(t,e){if(!t)return this.$L;var i=this.clone(),n=w(t,e,!0);return n&&(i.$L=n),i},v.clone=function(){return y.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},p}(),M=I.prototype;return C.prototype=M,[["$ms",i],["$s",n],["$m",r],["$H",s],["$W",o],["$M",h],["$y",c],["$D",u]].forEach((function(t){M[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),C.extend=function(t,e){return t.$i||(t(e,I,C),t.$i=!0),C},C.locale=w,C.isDayjs=b,C.unix=function(t){return C(1e3*t)},C.en=x[m],C.Ls=x,C.p={},C}()}));function P(t,e,i){for(var n=e>i?function(){return e--}:function(){return e++},r=e>i?function(){return i>e}:function(){return e>i},s=!1;!r()&&!s;)s=!1===t(n())}function K(t,e){var i=t.findIndex(e);if(i>-1)return t.splice(i,1)[0]}function Y(t,e){var i=typeof t;if(i!==typeof e)return!1;var n=i;if(["string","number","undefined"].includes(n)||null===t||null===e)return t===e;if(Array.isArray(t)&&Array.isArray(e))return t.every((function(t,i){return Y(t,e[i])}));if("object"===n){var r=Object.keys(t);return r.length===Object.keys(e).length&&r.every((function(i){return Y(t[i],e[i])}))}return!0}function V(){return window.devicePixelRatio||1}function U(t){return parseInt(t*V(),10)}var X=function(){function t(t,e,i){this.el=t,this.ctx=t.getContext("2d"),this.resize(e,i),this.__cacheImgs=new Map}var e=t.prototype;return e._getImage=function(t){var e,i,n=this;e=t,(i=document.createElement("A")).href=e;var r=this.__cacheImgs.get(t=i.href);return r?Promise.resolve(r):new Promise((function(e){(r=new Image).onload=function(){n.__cacheImgs.set(t,r),e(r)},r.src=t}))},e.resize=function(t,e){this.el.style.width=t+"px",this.el.style.height=e+"px",this.el.width=U(t),this.el.height=U(e),this.ctx.scale(V(),V())},e.rect=function(t){void 0===t&&(t={});var e=this.ctx,n=t.x,r=t.y,s=t.width,o=t.height,l=t.borderColor,h=t.borderWidth,a=t.borderTop,c=t.borderRight,u=t.borderBottom,d=t.fill;e.save();var f=parseInt(d.slice(7,9),16)/255;1>f&&(e.globalAlpha=f,d=d.slice(0,7)),e.beginPath(),e.fillStyle=d,e.rect(n,r,s,o),e.clip(),e.fill(),e.restore(),l&&this.border(i({},t,{x:t.x-h,y:t.y-h,borderWidth:h,borderColor:l,borderTop:a,borderRight:c,borderBottom:u}))},e.text=function(t){void 0===t&&(t={});var e=t.x,i=t.y,n=t.maxWidth,r=t.fill,s=t.text,o=t.fontSize,l=t.fontFamily;this.ctx.save(),o&&(this.ctx.fontSize=o),l&&(this.ctx.fontFamily=l),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle=r,this.ctx.fillText(s,e,i,n),this.ctx.restore()},e.image=async function(t){void 0===t&&(t={}),console.log("draw image");var e=t.x,i=t.y,n=t.width,r=t.height,s=t.src,o=await this._getImage(s);this.ctx.drawImage(o,Math.floor(e),Math.floor(i),n,r)},e.border=function(t){void 0===t&&(t={});var e=this.ctx,i=t.width,n=t.height,r=t.x,s=t.y,o=t.borderTop,l=void 0===o||o,h=t.borderRight,a=void 0===h||h,c=t.borderBottom,u=void 0===c||c,d=t.fill,f=t.borderWidth,g=t.borderColor;e.save(),e.lineWidth=f;var p=function t(i,n,r){e.beginPath(),e.strokeStyle=i?g:d,e.moveTo.apply(e,n),e.lineTo.apply(e,r),e.stroke(),"dash"===i&&(e.setLineDash([5,6]),t(!1,n,r),e.setLineDash([]))},v=r+2*f+i,m=s+2*f+n,x=f/2;p(l,[r,s+x],[v,s+x]),p(a,[v-x,s],[v-x,m]),p(u,[v,m-x],[r,m-x]),p(a,[r+x,m],[r+x,s]),e.restore()},t}(),G=function(){function t(t,e){var i=this;this.container=t,this.onSelect=function(){};var n=document.createElement("ul");n.className="schedule-contextmenu",e.forEach((function(t){var e=document.createElement("li");e.className="schedule-contextmenu-item",e.innerText=t.title,e.dataset.action=t.action,n.appendChild(e)})),this.menu=n,this.hide=this.hide.bind(this),this.hide(),window.addEventListener("click",this.hide),n.onclick=function(t){i.hide();var n=t.target.dataset.action;n&&i.onSelect(n,e.find((function(t){return t.action===n})))},this.container.appendChild(this.menu)}var e=t.prototype;return e.onContextMenuItemSelect=function(t){this.onSelect=t},e.isVisible=function(){return"visible"===this.menu.style.visibility},e.show=function(t){var e=t.x,i=t.y;this.menu.style.visibility="visible",this.menu.style.transform="translate3d("+e+"px, "+i+"px, 0)"},e.hide=function(){this.menu.style.visibility="hidden"},t}(),q="contextMenuItemSelect",J="select",Z="timeRangeChange",Q="resize",tt={on:function(t,e){this._eventHandlers||(this._eventHandlers={}),this._eventHandlers[t]||(this._eventHandlers[t]=[]),this._eventHandlers[t].push(e)},off:function(t,e){var i=this._eventHandlers[t];if(i)for(var n=0;i.length>n;n++)i[n]===e&&i.splice(n--,1)},emit:function(t){for(var e=this,i=arguments.length,n=Array(i>1?i-1:0),r=1;i>r;r++)n[r-1]=arguments[r];return!!(this._eventHandlers&&this._eventHandlers[t]&&this._eventHandlers[t].length)&&(this._eventHandlers[t].forEach((function(t){return t.apply(e,n)})),!0)}},et=function(){function t(t,e,i){var n=void 0===i?{}:i,r=n.cells,s=n.rowHeader,o=n.colHeader,l=n.highlights,h=n.contextMenu,a=n.tooltip;this.schedule=t,this.canvas=t.canvas,this.settings=t.settings,this.items=e,this.cells=r,this.rowHeader=s,this.colHeader=o,this.highlights=l,this.contextMenu=h,this.tooltip=a,this.currentSelection=null,this.selections=[],this.cells.setTable(this),this.rowHeader.setTable(this),this.colHeader.setTable(this)}var e=t.prototype;return e.setItems=function(t,e){var i=this,n=[].concat(e),r=[];t.forEach((function(t){var e=K(n,(function(e){return e.colIdx===t.colIdx&&e.rowIdx===t.rowIdx}));e?function(t,e){var i=Object.keys(t),n=Object.keys(e),r=[];return new Set([].concat(i,n)).forEach((function(s){i.includes(s)&&n.includes(s)&&Y(t[s],e[s])||r.push({key:s,value:[t[s],e[s]]})})),r}(t.data,e.data).length&&r.push(t):r.push(t)})),r.length&&this.cells.render(r),n.forEach((function(t){var e=i.getCell(t.colIdx,t.rowIdx);e.hasData()&&(i.currentSelection?i.currentSelection.deleteCell(e):e.delete())})),this.items=t},e.render=function(t,e){var i=this,n=this.settings,r=n.fontSize,s=n.fontFamily,o=n.numberOfCols,l=n.numberOfRows,h=n.cellBorderWidth,a=n.colHeaderWidth,c=n.timeScale;this.cellWidth=Math.floor((t-h-a)/o);var u=l+(this.rowHeader?1:0);this.cellHeight=Math.floor((e-h)/u)*c,this.settings.rowHeaderHeight=this.cellHeight/c,e=this.cellHeight/c*u+h,Y(t=this.cellWidth*o+a+h,this.tableWidth)&&Y(e,this.tableHeight)||(this.tableWidth=t,this.tableHeight=e,this.schedule.container.style.width=this.tableWidth+"px",this.schedule.container.style.height=this.tableHeight+"px",setTimeout((function(){i.schedule.emit(Q,i.tableWidth,i.tableHeight)}),0),this.draw?this.draw.resize(this.tableWidth,this.tableHeight):this.draw=new X(this.canvas,this.tableWidth,this.tableHeight),this.draw.ctx.font=r+"px "+s,this.cells.setRenderer(this.draw),this.rowHeader.setRenderer(this.draw),this.colHeader.setRenderer(this.draw),this.cells.render(),this.rowHeader.render(),this.colHeader.render(),this.highlights.adjustAll())},e.cellsEach=function(t,e){this.cells.cellsEach(t,e)},e.cellGroupsEach=function(t,e){return this.cells.cellGroupsEach(t,e)},e.getCell=function(t,e,i){return this.cells.getCell(t,e,i)},e.getColIdx=function(t){return Math.floor((t-this.cells.startingCoords.x)/this.cellWidth)},e.getRowIdx=function(t){return Math.floor((t-this.cells.startingCoords.y)/this.cellHeight)},e.getCellByCoord=function(t,e){var i=t.y;return this.getCell(Math.floor((t.x-this.cells.startingCoords.x)/this.cellWidth),Math.floor((i-this.cells.startingCoords.y)/this.cellHeight),e)},e.sort=function(t,e){var i=function(t,i){return e?t>i:i>t};return[].concat(t).sort((function(t,e){return i(t.colIdx,e.colIdx)?-1:t.colIdx===e.colIdx?i(t.rowIdx,e.rowIdx)?-1:1:void 0}))},e.getCellsBetween=function(t,e,i){var n=this.sort([t,e]),r=[];return this.cellsEach((function(t){if(i&&i(t))return!1;r.push(t)}),{cellFrom:n[0],cellTo:n[1]}),r},e.getEmptyCellsBetween=function(t,e){return this.getCellsBetween(t,e,(function(t){return t.hasData()&&!t.isSame(_cellFrom)}))},e.selectMultiCols=function(t,e,i){var n=t.colIdx,r=[],s=function(){return e>=n},o=function(){return n++};for(n>e&&(s=function(){return n>=e},o=function(){return n--});s();){var l=this.getCell(o(),t.rowIdx);l.select(),r.push(this.mergeCols(l,i))}return r},e.mergeCols=function(t,e){var i=this.getCell(t.colIdx,e),n=this.getEmptyCellsBetween(t,i);return t.merge(n)},e.mouseInCell=function(t){if(!this.contextMenu.isVisible()){this.cellsEach((function(t){return t.mouseOut()})),this.schedule.hideTooltip();var e=this.getCellByCoord(t,!1);!e||this.settings.readOnly&&!e.hasData(!0)||((e=e.getCell()).mouseIn(),this.schedule.showTooltip(e))}},e.highlightSelections=function(t){this.selections.forEach((function(t){return t.highlight()}))},e.removeHighlights=function(){this.highlights.clear()},e.setSelection=function(t){this.currentSelection=t},e.addSelection=function(t){this.selections.push(t)},e.clearSelection=function(){this.selections.forEach((function(t){return t.deselect()})),this.selections=[],this.currentSelection=null},e.getSelections=function(){return this.selections},e.finishSelection=function(){var t=this.currentSelection;if(t){var e=0;this.highlightSelections(),t.finish();var i=[];this.selections.forEach((function(t){return t.batchedCells.forEach((function(t){i.push({data:t.data,timeRange:t.timeRange.map((function(t){return t.format("YYYY-MM-DD HH:mm:ss")}))}),e++}))})),e>1?this.schedule.container.classList.add("schedule-multi-select"):this.schedule.container.classList.remove("schedule-multi-select"),this.schedule.emit(J,i);var n=t.getCell();if(n.data){var r=this.settings.timeRangeKey,s=function(t,e){return t.map((function(t){return t.format(e)}))}(n.timeRange,"YYYY-MM-DD HH:mm:ss"),o=n.data[r];o&&!Y(s,o)&&(n.data[r]=s,this.schedule.emit(Z,s,o))}}},e.showContextMenu=function(t){this.currentSelection&&(this.currentSelection.getCell().hasData(!0)&&(this.tooltip.hide(),this.contextMenu.show(t)))},t}(),it=t((function(t){function e(i,n){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.default=t.exports,t.exports.__esModule=!0,e(i,n)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0})),nt=t((function(t){t.exports=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,it(t,e)},t.exports.default=t.exports,t.exports.__esModule=!0})),rt=t((function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0})),st=function(){function t(){this.draw=null,this.table=null}var e=t.prototype;return e.setRenderer=function(t){this.draw=t},e.setTable=function(t){this.table=t},t}(),ot=function(t){function e(e){var i,n=e.colIdx,r=e.rowIdx,s=e.label,o=e.parent,l=e.dashLine;return(i=t.call(this)||this).colIdx=n,i.rowIdx=r,i.label=s,i.parent=o,i.borderWidth=1,i.borderTop=1,i.borderRight=1,i.borderBottom=1,i.borderLeft=1,i.dashLine=l,i.mergedCells=[rt(i)],i.setTable(o.table),i.setRenderer(o.draw),i.table=o.table,i.timeRange=null,i.setTimeRange(),i.init(),i.width=0,i.height=0,i}nt(e,t);var n=e.prototype;return n.init=function(){this.selected=!1,this.hovering=!1,this.__actualCell=this,this.data=null},n.getCell=function(){return this.__actualCell},n.getColor=function(){var t=this.table.settings,e=t.cellActiveColor,i=t.cellCrossColAlpha,n=this.selected||this.hovering?t.cellSelectedColor:t.bgColor;return this.data&&(n=this.getDataValue("color")||e),this.isCrossCol()?n=this.getCell().getColor()+Math.round(255*i).toString(16):this.getCell()!==this&&(n=null),n},n.isCrossCol=function(t){var e=this.getCell();return e!==this&&0===this.rowIdx&&(t?this.colIdx===e.colIdx+t:this.colIdx!==e.colIdx)},n.getIcon=function(){return this.getDataValue("icon")},n.getTexts=function(){return this.getDataValue("texts")},n.setTimeRange=function(){var t=this.table.settings,e=t.timeScale,i=t.yearMonth.add(60*this.rowIdx*e+24*this.colIdx*60,"minute"),n=i.add(60*this.getRowSpan()*e,"minute");this.timeRange=[i,n]},n.getCoords=function(t){var e=this.parent;return{x:this.colIdx*e.cellWidth+this.parent.startingCoords.x+(t?this.width/2:0),y:this.rowIdx*e.cellHeight+this.parent.startingCoords.y+(t?this.height/2:0)}},n.getDataValue=function(t,e){void 0===e&&(e=this.data);var i,n=this.table.settings,r=n.renderCell,s=n.dataMaps;if(s&&(i=s[t]),t=this.table.settings[t+"Key"],"function"==typeof r){var o=r(e);return o?o[t]:null}if(!e)return null;if(i){var l=i.find((function(i){return i.key===e[t]}));return l?l.value:null}return e[t]},n.getHighlightConfigs=function(){var t=this.parent.cellWidth,e=this.getColHeight(),i=this.table.settings.cellBorderWidth,n=this.getMergedCells(),r=null,s=-1,o=[];return n.forEach((function(t){null!==r&&t.colIdx===r||(o.push([]),r=t.colIdx,s++),o[s].push(t)})),o.map((function(n){return{width:t-i,height:n.length*e-i,coords:n[0].getCoords()}}))},n.getMergedCells=function(){return this.mergedCells},n.renderRect=function(t){var e=this.rowIdx,n=this.table.settings,r=n.cellBorderWidth,s=n.cellBorderColor;this.width=this.parent.cellWidth-r,this.height=this.getColHeight({includesMerged:!0})-r,this.draw.rect(i({},this.getCoords(),{width:this.width,height:this.height,fill:t,borderColor:s,borderWidth:r},this.dashLine&&!this.hasData()?{borderTop:e%2==0||"dash",borderBottom:e%2!=0||"dash"}:{}))},n.render=function(){if(!this.hidden){var t=this.table.settings.bgColor,e=this.getColor();if(e){e.length>7&&this.renderRect(t),this.renderRect(e);var i=this.getCrossColHeight(1);if(this.data&&this.height>i&&this.renderIconAndTexts(this.getIcon(),this.getTexts()),this.isCrossCol(1)&&i>this.height){var n=this.getCell();this.renderIconAndTexts(n.getIcon(),n.getTexts(),i)}this.renderLabel(this.label)}}},n.renderLabel=function(t){if("string"==typeof t){var e=this.getCoords(!0);this.draw.text({text:t,x:e.x,y:e.y,fill:this.table.settings.headerTextColor})}},n.renderIconAndTexts=function(t,e,i){var n=this,r=this.getCoords(!0),s=r.x,o=r.y,l=i||this.height;if(o=i?this.parent.startingCoords.y+l/2:o,e||t){var h=this.table.settings,a=h.fontSize,c=h.fontColor,u=h.lineHeight,d=Math.min(this.width-5,h.iconMaxWidth),f=0;if(d+u>l?(e||d+5>l)&&(t=null,f=1):e&&(f=Math.min(e.length,Math.floor((l-(t?d:0))/u))),e=e.slice(0,f),o-=(f-1)/2*u,t&&(this.draw.image({src:t,x:s-d/2,y:o-=d,width:d,height:d}),o+=d+10),e){var g=this.width/parseInt(a);e.forEach((function(t){n.draw.text({text:(t+"").slice(0,g),x:s,y:o,fill:c}),o+=u}))}}},n.setData=function(t){if(this.selected&&this.isVisible()){var e,n;if(!this.data)this.data=((n={})[this.table.settings.timeRangeKey]=this.timeRange,n);var r=i({},this.data,t||{});"function"==typeof t&&(r=t(cell.data||{}));var s=this.table.settings,o=s.colorKey,l=s.iconKey,h=s.textsKey,a=i({},this.data);return this.data=r,this.renderIfPropsChanged(((e={})[o]=this.getDataValue("color",r),e[l]=this.getDataValue("icon",r),e[h]=this.getDataValue("texts",r),e),a),!0}return!1},n.mouseIn=function(){return!this.hasData()&&this.renderIfPropsChanged({hovering:!0}),this},n.mouseOut=function(){return!this.hasData()&&this.renderIfPropsChanged({hovering:!1}),this},n.select=function(){return this.hasData()?this.selected=!0:this.renderIfPropsChanged({selected:!0}),this},n.deselect=function(){return this.hasData()?this.selected=!1:this.mergedCells.forEach((function(t){return t.clear()})),this},n.renderIfPropsChanged=function(t,e){if(void 0===e&&(e=this),this.getCell()!==this&&!this.isCrossCol())return this.getCell().renderIfPropsChanged(t);var i=!1;return Object.keys(t).forEach((function(n){t[n]!==e[n]&&(e[n]=t[n],i=!0)})),i&&this.renderMerged(),i},n.renderMerged=function(){this.render(),this.mergedCells.forEach((function(t){return t.isCrossCol()&&t.render()}))},n.cloneFrom=function(t){return this.selected=t.selected,this.data=t.data,this},n.merge=function(t){var e=t[0];if(e===this){var i=[];return[].concat(this.__actualCell.mergedCells,t).filter((function(t){return t!==e})).forEach((function(n){n.getCell()===e||n.hasData()||n.delete(),i.find((function(t){return t.isSamePosition(n)}))||(n.init(),n.unMerge(),i.push(n)),t.includes(n)&&(n.__actualCell=e)})),e.mergedCells=[].concat(t),e.__actualCell=e,i.push(e),i.forEach((function(t){return t.render()})),e.setTimeRange(),e}},n.unMerge=function(){return this.mergedCells=[this],this.setTimeRange(),this},n.getColHeight=function(t){var e=void 0===t?{}:t,i=e.includesMerged,n=e.includesColIdx,r=this.parent.cellHeight,s=this.isCrossCol()?this.getCell():this,o=n||this.colIdx;return i||n?s.mergedCells.filter((function(t){return t.colIdx===o})).length*r:r},n.getCrossColHeight=function(t){var e=this.getCell().mergedCells[0].colIdx+t;return this.getColHeight({includesColIdx:e})},n.getRowSpan=function(t){var e=this.mergedCells;return"number"!=typeof t?e.length:(t+=e[0].colIdx,e.filter((function(e){return e.colIdx===t})).length)},n.getRowIdxOfLastCell=function(){var t=this.getMergedCells();return t[t.length-1].rowIdx},n.clear=function(){this.mergedCells.forEach((function(t){t.init(),t.render()})),this.mergedCells[0].unMerge()},n.delete=function(){this.deselect(),this.clear()},n.isBefore=function(t){return this.colIdx===t.colIdx?t.rowIdx>this.rowIdx:t.colIdx>this.colIdx},n.isSame=function(t){return this.getCell()===t.getCell()},n.isSamePosition=function(t){return this.colIdx===t.colIdx&&this.rowIdx===t.rowIdx},n.isVisible=function(){return this.__actualCell===this},n.isSelected=function(){return this.getCell().selected},n.hasData=function(t){return t?!!this.getCell().data:!!this.data},e}(st);Object.assign(ot.prototype,tt);var lt=function(t){function e(){var e;return(e=t.call(this)||this)._cells=[],e.startingCoords={x:0,y:0},e}nt(e,t);var i=e.prototype;return i.init=function(){for(var t=this.table.settings,e=t.numberOfCols,i=t.numberOfRows,n=t.timeScale,r=0;e>r;r++){this._cells[r]=[];for(var s=0;i/n>s;s++){var o=new ot({colIdx:r,rowIdx:s,parent:this,dashLine:!0});0===s&&0===r&&(o.colSpan=2),this._cells[r].push(o)}}},i.refresh=function(){this.cellGroupsEach((function(t){return!t.selected&&t.clear()})),this.render()},i.adjust=function(){var t=this.table.settings,e=t.cellBorderWidth,i=this.table,n=i.cellWidth,r=i.cellHeight;this.startingCoords={x:t.colHeaderWidth+e,y:t.rowHeaderHeight+e},this.cellWidth=n,this.cellHeight=r},i.render=function(t){var e=this;this._cells.length||this.init(),this.adjust();var i,n=(t=this.table.sort(t||this.table.items)).shift();this.cellsEach((function(r){n&&r.colIdx===n.colIdx&&r.rowIdx===n.rowIdx?(r.data=n.data,i=e.table.getCellsBetween(r,e.getCell(r.colIdx,r.rowIdx+n.rowSpan)),r.merge(i),n=t.shift()):r.render()}))},i.cellsEach=function(t,e){var i=void 0===e?{}:e,n=i.cellFrom,r=i.cellTo,s=i.rowSpan,o=i.reverse,l=this._cells,h=0,a=0;if(n)h=n.colIdx,a=n.rowIdx;else if(o){var c=this.table.settings;h=c.numberOfCols.length-1,a=c.numberOfRows.length-1}for(var u=l[h],d=0,f=!1;!f&&u;){var g=u[a];g?(!1===t(g,h,a)&&(f=!0),r&&r===g&&(u=null),o?a--:a++):(a=0,u=l[o?--h:++h]),s&&d++===s&&(u=null)}},i.cellGroupsEach=function(t,e){return this.cellsEach((function(e){return e.isVisible()&&t(e),!0}),e)},i.getCells=function(){return this._cells},i.getCell=function(t,e,i){void 0===i&&(i=!0);try{if(i){var n=this.table.settings.numberOfRows/this.table.settings.timeScale;if(e>n-1||0>e){var r=t*n+e;t=Math.floor(r/n),e=r%n}}return this.getCells()[t][e]||null}catch(t){return null}},e}(st),ht=function(t){function e(){var e;return(e=t.call(this)||this)._cells=[],e.startingCoords={x:0,y:0},e}nt(e,t);var i=e.prototype;return i.init=function(){for(var t=0;this.table.settings.numberOfCols>t;t++){this._cells[t]=[];var e=new ot({colIdx:t,rowIdx:0,label:t+1+"",parent:this});e.setRenderer(this.draw),e.setTable(this.table),this._cells[t]=e}},i.adjust=function(){var t=this.table,e=this.table.settings,i=e.colHeaderWidth,n=e.cellBorderWidth,r=e.rowHeaderHeight;this.cellWidth=t.cellWidth,this.cellHeight=r,this.startingCoords={x:i+n,y:n}},i.render=function(){this._cells.length||this.init(),this.adjust(),this._cells.forEach((function(t){return t.render()}))},e}(st),at=function(t){function e(){var e;return(e=t.call(this)||this)._cells=[],e.startingCoords={x:0,y:0},e}nt(e,t);var i=e.prototype;return i.init=function(){for(var t=0;this.table.settings.numberOfRows+1>t;t++){this._cells[t]=[];var e=new ot({colIdx:0,rowIdx:t,label:0===t?"":t-1+"-"+t,parent:this});e.setRenderer(this.draw),e.setTable(this.table),this._cells[t]=e}},i.renderCornerLeft=function(){this.draw.text({text:"时",x:.3*this.cellWidth,y:.75*this.cellHeight}),this.draw.text({text:"日",x:.75*this.cellWidth,y:.4*this.cellHeight});var t=this.table.settings,e=t.cellBorderColor,i=t.cellBorderWidth;this.draw.ctx.save(),this.draw.ctx.strokeStyle=e,this.draw.ctx.lineWidth=i,this.draw.ctx.beginPath(),this.draw.ctx.moveTo(0,0),this.draw.ctx.lineTo(this.cellWidth,this.cellHeight),this.draw.ctx.stroke(),this.draw.ctx.restore()},i.adjust=function(){var t=this.table,e=t.cellHeight,i=t.settings,n=i.cellBorderWidth,r=i.colHeaderWidth,s=i.timeScale;this.startingCoords={x:n,y:n},this.cellWidth=r,this.cellHeight=e/s},i.render=function(){this._cells.length||this.init(),this.adjust(),this._cells.forEach((function(t){return t.render()})),this.renderCornerLeft()},e}(st),ct=function(){function t(t,e){this.rootNode=t,this.onResize=e,this._highlightList=[]}var e=t.prototype;return e.clearHighlights=function(t){t._members.forEach((function(t){t.style.visibility="hidden"})),t.cell=null},e.createNew=function(){var t={_members:[],cell:null};return this._highlightList.push(t),t},e.createHighlight=function(t){var e=document.createElement("div");return e.className="schedule-highlight",e.upResize=document.createElement("div"),e.upResize.className="schedule-highlight-up-resize",e.downResize=document.createElement("div"),e.downResize.className="schedule-highlight-down-resize",e.appendChild(e.upResize),e.appendChild(e.downResize),this.rootNode.appendChild(e),t._members.push(e),e},e.getCoords=function(t){var e=this.rootNode.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}},e.adjust=function(t){var e=this,i=t.cell.getHighlightConfigs(),n=i.length;i.forEach((function(i,n){var r=i.coords,s=i.width,o=i.height,l=t._members[n]||e.createHighlight(t);l.className="schedule-highlight",l.style.transform="translate3d("+r.x+"px, "+r.y+"px, 0)",l.style.width=s+"px",l.style.height=o+"px",l.style.visibility="visible"})),n>1&&(t._members[0].classList.add("disabled-down-resize"),t._members[n-1].classList.add("disabled-up-resize"),t._members.slice(1,n-1).forEach((function(t){return t.classList.add("disabled-down-resize","disabled-up-resize")})))},e.adjustAll=function(){var t=this;this._highlightList.forEach((function(e){e.cell&&t.adjust(e)}))},e.show=function(t){var e=this._highlightList.find((function(t){return!t.cell}));e||(e=this.createNew()),e.cell=t,this.adjust(e)},e.clear=function(){var t=this;this._highlightList.forEach((function(e){return t.clearHighlights(e)}))},t}(),ut=function(){function t(t,e){this._color=e,this.container=t,this.tooltip=document.createElement("div"),this.tooltip.className="schedule-tooltip",this.icon=document.createElement("img"),this.icon.className="schedule-tooltip-icon",this.text=document.createElement("div"),this.text.className="schedule-tooltip-text",this.tooltip.appendChild(this.text),this.tooltip.appendChild(this.icon),this._config={color:e,text:null,icon:null},t.appendChild(this.tooltip)}var e=t.prototype;return e.show=function(t){this.tooltip.style.visibility="visible",this.refresh(t)},e.refresh=function(t){var e="function"==typeof t?t(this._config):t,i=e.color,n=e.text,r=e.x,s=e.y,o=e.cellWidth;this.showIcon(e.icon),this.setBackgroundColor(i),this.setText(n);var l=this.tooltip.getBoundingClientRect(),h=this.container.getBoundingClientRect();r+h.x+l.width+100>window.innerWidth&&(r-=l.width+o+3),s+h.y+l.height>window.innerHeight&&(s=h.height-l.height),this.tooltip.style.transform="translate3d("+((r=Math.floor(r))+3)+"px, "+(s=Math.floor(s))+"px, 0)"},e.setBackgroundColor=function(t){this._config.color=t||this._color,this.tooltip.style.backgroundColor=this._config.color},e.showIcon=function(t){this._config.icon=t||null,this.icon.style.display=this._config.icon?"block":"none",this._config.icon&&(this.icon.src=this._config.icon)},e.setText=function(t){this._config.text=t,this.text.innerHTML=this._config.text},e.hide=function(){this.tooltip.style.visibility="hidden"},t}(),dt=function(){function t(t,e){this.cell=null,this.rowFrom=null,this.colFrom=null,this.rowSpan=null,this.rowIdxOfLastCell=null,this.schedule=t,this.table=t.table,this.inProgress=!0,this.batchedCells=[],this.setCell(e),this.positionOfAdjustment=null}var e=t.prototype;return e.select=function(t,e){t=Math.max(0,t),this.selectMultiCol(this.positionOfAdjustment?this.colFrom:t,e)},e.selectMultiCol=function(t,e){var i=this,n=[].concat(this.batchedCells);this.batchedCells=[];var r=[],s={colIdx:t,rowIdx:e};P((function(t){var o=i.adjust(t,e);if(t!==i.colFrom&&i.colMeetData(o))return s.colIdx=t,!1;o.length&&(r.push(o),K(n,(function(t){return o.some((function(e){return e.colIdx===t.getCell().colIdx}))})))}),this.colFrom,t);var o=r.reduce((function(t,e){return Math.min(t,e.length)}),r[0].length);r.forEach((function(t){t=i.rowFrom>e?t.reverse().slice(0,o).reverse():t.slice(0,o);var n=i.mergeRow(t);i.setCell(n),i.batchedCells.push(n),s.rowIdx=t[0].rowIdx})),n.forEach((function(t){return t.getCell().deselect()})),this.schedule.showTooltip(this.table.getCell(s.colIdx,s.rowIdx))},e.move=function(t,e){this.table.removeHighlights();var i=this.table.settings;this.selectMultiCol(this.colFrom,e+(t-this.colFrom)*i.numberOfRows/i.timeScale)},e.cutCells=function(t,e){return 1===t.length?t:t[0].rowIdx>t[1].rowIdx?t.reverse().slice(0,e).reverse():t.slice(0,e)},e.mergeRow=function(t){var e=this.cell.getCell();return t[0].cloneFrom(e).merge(t)},e.colMeetData=function(t){return!t.length||t.some((function(t){return t.getCell().hasData()}))},e.getEmptyCellsAtCol=function(t,e,i){var n=this,r=[],s=this.cell;return P((function(e){var i=n.table.getCell(t,e);if(i){if(!s.isSame(i)&&i.getCell().hasData())return!1;r.push(i)}}),e,i),e>i?r.reverse():r},e.adjust=function(t,e){if(!this.positionOfAdjustment&&!this.cell.hasData())return this.getEmptyCellsAtCol(t,this.rowFrom,e);if("down"===this.positionOfAdjustment)return this.getEmptyCellsAtCol(this.colFrom,this.rowFrom,Math.max(this.rowFrom,e-this.rowIdxOfLastCell+this.rowFrom+this.rowSpan-1));if("up"===this.positionOfAdjustment){var i=this.rowFrom+this.rowSpan-1;return this.getEmptyCellsAtCol(this.colFrom,i,Math.min(i,e))}},e.setCell=function(t){this.cell=t.getCell().select()},e.getCell=function(){return this.cell},e.begin=function(t,e){t&&this.setCell(t),this.batchedCells=[this.cell],this.positionOfAdjustment=e||null,this.rowFrom=this.cell.rowIdx,this.colFrom=this.cell.colIdx,this.rowSpan=this.cell.getRowSpan(),this.rowIdxOfLastCell=this.cell.getRowIdxOfLastCell(),this.table.removeHighlights(),this.inProgress=!this.cell.hasData(!0)||e},e.finish=function(){this.currentCell=null,this.inProgress=!1,this.positionOfAdjustment=null},e.isInProgress=function(){return this.inProgress},e.deselect=function(t){this.table.removeHighlights(),this.batchedCells.forEach((function(t){return t.getCell().deselect()}))},e.highlight=function(){var t=this;this.batchedCells=this.batchedCells.filter((function(e){return!!e.selected&&(t.table.highlights.show(e.getCell()),!0)}))},e.refresh=function(t){this.deselect(),this.setCell(t),this.batchedCells=[this.cell],this.highlight()},e.deleteCell=function(t){var e=this.getCell(),i=t||e;i.isSame(e)&&this.deselect(),i.delete()},t}();t((function(t,e){function i(t){if(t&&"object"==typeof t){var e=t.which||t.keyCode||t.charCode;e&&(t=e)}if("number"==typeof t)return o[t];var i,s=t+"";return(i=n[s.toLowerCase()])?i:(i=r[s.toLowerCase()])||(1===s.length?s.charCodeAt(0):void 0)}i.isEventKey=function(t,e){if(t&&"object"==typeof t){var i=t.which||t.keyCode||t.charCode;if(null==i)return!1;if("string"==typeof e){var s;if(s=n[e.toLowerCase()])return s===i;if(s=r[e.toLowerCase()])return s===i}else if("number"==typeof e)return e===i;return!1}};var n=(e=t.exports=i).code=e.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r=e.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};
/*!
 * Programatically add the following
 */
for(s=97;123>s;s++)n[String.fromCharCode(s)]=s-32;for(var s=48;58>s;s++)n[s-48]=s;for(s=1;13>s;s++)n["f"+s]=s+111;for(s=0;10>s;s++)n["numpad "+s]=s+96;var o=e.names=e.title={};for(s in n)o[n[s]]=s;for(var l in r)n[l]=r[l]}));var ft=function(){function t(t){this.schedule=t,this.table=t.table,this.canvas=this.table.canvas,this.container=t.container,this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onContextMenuItemSelect=this.onContextMenuItemSelect.bind(this),this.onKeydown=this.onKeydown.bind(this),this.table.settings.readOnly||(this.container.addEventListener("mousedown",this.onMouseDown),window.addEventListener("mouseup",this.onMouseUp),this.container.addEventListener("contextmenu",this.onContextMenu),document.addEventListener("keydown",this.onKeydown)),window.addEventListener("mousemove",this.onMouseMove),this.table.contextMenu.onContextMenuItemSelect(this.onContextMenuItemSelect)}var e=t.prototype;return e.addResizeListener=function(t,e){new N((function(t,i){var n=t[0].contentRect;e(n.width,n.height)})).observe(t)},e.addEventListener=function(){},e.onMouseDown=function(t){if(t.preventDefault(),!t.target.classList.contains("schedule-contextmenu-item")){var e=this.getCoords(t),i=this.table.getCellByCoord(e),n=this.table.currentSelection;if(t.target.classList.contains("schedule-highlight-down-resize"))return n.begin(null,"down");if(t.target.classList.contains("schedule-highlight-up-resize"))return n.begin(null,"up");if(t.shiftKey){var r=this.table.getColIdx(e.x),s=this.table.getRowIdx(e.y);return n.move(r,s)}if(t.ctrlKey||t.metaKey||this.table.clearSelection(),i&&!i.isSelected()){var o=new dt(this.schedule,i);o.begin(i),this.table.setSelection(o),this.table.addSelection(o)}}},e.onMouseUp=function(){event.preventDefault(),this.table.finishSelection()},e.onMouseMove=function(t){t.preventDefault();var e=this.getCoords(t);this.table.getCellByCoord(e);var i=this.table.currentSelection;if(i&&i.isInProgress()){var n=this.table.getColIdx(e.x),r=this.table.getRowIdx(e.y);i.select(n,r)}else this.table.mouseInCell(e)},e.onResize=function(){},e.onContextMenu=function(t){t.preventDefault(),this.table.showContextMenu(this.getCoords(t))},e.onContextMenuItemSelect=function(t,e){var i=this.table.currentSelection;i&&t&&(this.schedule.emit(q,t,this.schedule,i.getCell().data,e)||"delete"!==t||i.deleteCell())},e.onKeydown=function(t){},e.clear=function(){this.container.removeEventListener("mousedown",this.onMouseDown),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("mousemove",this.onMouseMove),this.container.removeEventListener("contextmenu",this.onContextMenu),document.removeEventListener("keydown",this.onKeydown)},e.getCoords=function(t){var e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}},t}(),gt=function(){return{data:void 0,yearMonth:void 0,numberOfRows:24,readOnly:!1,bgColor:"#ffffff",cellBorderColor:"#EBEEF5",cellBorderWidth:1,cellSelectedColor:"#EBEEF5",cellActiveColor:"#D9D6EE",cellCrossColAlpha:.4,colHeaderWidth:50,rowHeaderHeight:void 0,fontSize:12,fontFamily:"PingFang SC,Helvetica Neue,Helvetica,microsoft yahei,arial,STHeiTi,sans-serif",fontColor:"#fff",lineHeight:20,cellTextColor:"#fff",headerTextColor:"#606266",timeRangeKey:"timeRange",iconMaxWidth:36,colorKey:"color",iconKey:"icon",textsKey:"texts",dataMaps:void 0,timeScale:1,tooltipColor:"#707070",renderTooltip:function(){},renderCell:void 0,contextMenuItems:void 0}};function pt(t,e){void 0===e&&(e={});var i=e.insertAt;if(t&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===i&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}pt(".schedule-canvas-container {\n  position: relative;\n}");pt(".schedule-highlight {\n  position: absolute;\n  top: 0;\n  left: 0;\n  border: 2px solid #999999;\n  pointer-events: none;\n  margin: -2px;\n  visibility: hidden;\n}\n\n.schedule-highlight-up-resize {\n  position: absolute;\n  width: 100%;\n  height: 8px;\n  top: -2px;\n  left: 0;\n  cursor: row-resize;\n  pointer-events: all;\n}\n\n.schedule-highlight-down-resize {\n  position: absolute;\n  width: 100%;\n  height: 8px;\n  bottom: -2px;\n  left: 0;\n  cursor: row-resize;\n  pointer-events: all;\n}\n\n.schedule-highlight.disabled-up-resize {\n  border-top-style: dotted;\n}\n\n.schedule-highlight.disabled-up-resize .schedule-highlight-up-resize {\n  pointer-events: none;\n}\n\n.schedule-highlight.disabled-down-resize {\n  border-bottom-style: dotted;\n}\n\n.schedule-highlight.disabled-down-resize .schedule-highlight-down-resize {\n  pointer-events: none;\n}\n\n.schedule-multi-select .schedule-highlight-up-resize, \n.schedule-multi-select .schedule-highlight-down-resize {\n  pointer-events: none;\n}");pt(".schedule-contextmenu {\n  position: absolute;\n  left: 0;\n  top: 0;\n  padding: 5px 0;\n  margin: 0;\n  background: #707070;\n  border: 1px solid #707070;\n  border-radius: 4px;\n  box-shadow: 2px 2px 8px 0px rgba(150, 150, 150, 0.2);\n  list-style: none;\n  font-size: 14px;\n  white-space: nowrap;\n  cursor: pointer;\n  z-index: 2800;\n  -webkit-tap-highlight-color: transparent;\n}\n\n.schedule-contextmenu-item {\n  padding: 5px 14px;\n  line-height: 1;\n  color: #fff;\n}\n\n.schedule-contextmenu-item:hover {\n  background: #585858;\n}");pt(".schedule-tooltip {\n  position: absolute;\n  left: 0;\n  top: 0;\n  line-height: 20px;\n  padding: 5px;\n  opacity: 0.9;\n  color: #ffffff;\n  font-size: 14px;\n  pointer-events: none;\n  border-radius: 4px;\n  z-index: 999;\n  background:#707070;\n  visibility: hidden;\n  word-break: break-all;\n}\n.schedule-tooltip-icon {\n  width: 24px;\n  height: 24px;\n}\n.schedule-tooltip p {\n  margin: 0;\n  max-width: 200px;\n}");var vt=function(){function t(t,e){this.rootNode=t,this.canvas=null,this.container=null,this.userSettings=e,this.createCanvas(),this.defaultSettings={data:void 0,yearMonth:void 0,numberOfRows:24,readOnly:!1,bgColor:"#ffffff",cellBorderColor:"#EBEEF5",cellBorderWidth:1,cellSelectedColor:"#EBEEF5",cellActiveColor:"#D9D6EE",cellCrossColAlpha:.4,colHeaderWidth:50,rowHeaderHeight:void 0,fontSize:12,fontFamily:"PingFang SC,Helvetica Neue,Helvetica,microsoft yahei,arial,STHeiTi,sans-serif",fontColor:"#fff",lineHeight:20,cellTextColor:"#fff",headerTextColor:"#606266",timeRangeKey:"timeRange",iconMaxWidth:36,colorKey:"color",iconKey:"icon",textsKey:"texts",dataMaps:void 0,timeScale:1,tooltipColor:"#707070",renderTooltip:function(){},renderCell:void 0,contextMenuItems:void 0},this.settings=i({},this.defaultSettings,this.userSettings),this.settings.contextMenuItems=this.combineContextMenuItems(e.contextMenuItems||[],[{action:"delete",title:"删除"}]),this.settings.yearMonth=j(e.yearMonth),this.settings.numberOfCols=this.settings.yearMonth.daysInMonth();var n=this.getItemsFromData(this.settings.data);this.table=new et(this,n,{cells:new lt(this),rowHeader:new ht(this),colHeader:new at(this),highlights:new ct(this.container),contextMenu:new G(this.container,this.settings.contextMenuItems),tooltip:new ut(this.container,this.settings.tooltipColor)}),this.events=new ft(this),this.render()}var e=t.prototype;return e.createCanvas=function(){this.canvas=document.createElement("canvas"),this.container=document.createElement("div"),this.container.className="schedule-canvas-container",this.container.appendChild(this.canvas),this.rootNode.prepend(this.container)},e.render=function(){var t=this,e=this.rootNode.getBoundingClientRect();this.table.render(e.width,e.height),new N((function(e,i){var n=e[0].contentRect;t.table.render(n.width,n.height)})).observe(this.rootNode)},e.combineContextMenuItems=function(){for(var t=[],e=arguments.length,i=Array(e),n=0;e>n;n++)i[n]=arguments[n];return i.reduce((function(t,e,i){return[].concat(t,e)}),[]).forEach((function(e){return!t.find((function(t){return t.action===e.action}))&&t.push(e)})),t},e.setData=function(t){var e=this.getItemsFromData(t),i=this.getItemsFromData(this.getData());this.table.setItems(e,i)},e.setDataAtSelectedCell=function(t){var e=[];this.table.cellsEach((function(t){t.selected&&t.isVisible()&&e.push(t)}));var n="function"==typeof t?t():t||{};if(1===e.length){var r=e[0],s=this.table.settings.timeRangeKey;if(n[s]&&r.data[s]&&!Y(r.data[s],n[s])){var o=this.getCellConfigFromTimeRange(n[s]),l=o.rowSpan,h=this.table.getCell(o.colIdx,o.rowIdx),a=i({},r.data,n);r.delete();var c=this.table.getCellsBetween(h,this.table.getCell(h.colIdx,h.rowIdx+l));return h.data=a,h.merge(c),void this.table.currentSelection.refresh(h)}}e.forEach((function(t){return t.setData(n)}))},e.getCellConfigFromTimeRange=function(t){var e=this.settings.timeScale,i=t[1],n=j(t[0]);return{colIdx:n.date()-1,rowIdx:(60*n.hour()+n.minute())/60/e,rowSpan:Math.abs(n.diff(i,"minute"))/(60*e)-1}},e.getItemsFromData=function(t){var e=this,i=this.settings,n=i.timeRangeKey;return t.map((function(t){var i=e.getCellConfigFromTimeRange(t[n]);return{colIdx:i.colIdx,rowIdx:i.rowIdx,rowSpan:i.rowSpan,data:t}}))},e.getData=function(){var t=[];return this.table.cellGroupsEach((function(e){e.hasData()&&t.push(e.data)})),t},e.exportData=function(){},e.getCellTimeStr=function(t){return t.colIdx+1+", "+t.timeRange.map((function(t){return t.format("HH:mm")})).join("~")},e.getTooltipConfig=function(t){var e=t.getCoords(),i=e.x,n=e.y,r=this.settings.renderTooltip,s=t.data&&r?r(t.data):"";return{x:i+t.width,y:n,text:"<p>"+this.getCellTimeStr(t)+"</p>"+s,color:t.hasData()?t.getColor():null,icon:t.getIcon(),cellWidth:t.width}},e.hideTooltip=function(){this.table.tooltip.hide()},e.showTooltip=function(t){if(t){var e=this.getTooltipConfig(t);this.table.tooltip.show(e)}},e.destroy=function(){this.events&&this.events.clear()},e.deleteSelectedCell=function(){this.table.currentSelection&&this.table.currentSelection.deleteCell()},e.getCanvas=function(){return this.canvas},t}();return Object.assign(vt.prototype,tt),vt.settingsFactory=gt,vt}));
